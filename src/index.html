<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glass Browser</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', system-ui, sans-serif;
            background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 50%, #2d2d2d 100%);
            color: white;
            height: 100vh;
            overflow: hidden;
            user-select: none;
        }
        
        .browser-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        /* Barra de navega√ß√£o */
        .nav-bar {
            height: 60px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            padding: 0 16px;
            gap: 12px;
            -webkit-app-region: drag;
        }
        
        .nav-controls {
            display: flex;
            gap: 8px;
            -webkit-app-region: no-drag;
        }
        
        .nav-btn {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.8);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            font-size: 16px;
        }
        
        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            transform: scale(1.05);
        }
        
        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .nav-btn:disabled:hover {
            transform: none;
        }
        
        /* Barra de endere√ßo */
        .address-container {
            flex: 1;
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 0 16px;
            height: 40px;
            -webkit-app-region: no-drag;
        }
        
        .address-bar {
            flex: 1;
            background: transparent;
            border: none;
            color: white;
            outline: none;
            font-size: 14px;
        }
        
        .address-bar::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .ssl-indicator {
            margin-right: 8px;
            color: #4CAF50;
            font-size: 14px;
        }
        
        /* Bot√µes da direita */
        .right-controls {
            display: flex;
            gap: 8px;
            -webkit-app-region: no-drag;
        }
        
        /* √Årea do webview */
        .webview-container {
            flex: 1;
            position: relative;
            background: #1a1a1a;
        }
        
        .webview {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, #007ACC, transparent);
            animation: loading 2s infinite;
            display: none;
        }
        
        @keyframes loading {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .loading-overlay.active {
            display: block;
        }
        
        /* Sidebar para bookmarks/hist√≥rico */
        .sidebar {
            position: absolute;
            top: 0;
            right: -300px;
            width: 300px;
            height: 100%;
            background: rgba(30, 30, 30, 0.95);
            backdrop-filter: blur(20px);
            border-left: 1px solid rgba(255, 255, 255, 0.1);
            transition: right 0.3s ease;
            z-index: 1000;
            display: flex;
            flex-direction: column;
        }
        
        .sidebar.open {
            right: 0;
        }
        
        .sidebar-header {
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }
        
        .bookmark-item, .history-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: background 0.2s ease;
        }
        
        .bookmark-item:hover, .history-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .favicon {
            width: 16px;
            height: 16px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .site-info {
            flex: 1;
            min-width: 0;
        }
        
        .site-title {
            font-size: 14px;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .site-url {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* Barra de status */
        .status-bar {
            height: 24px;
            background: rgba(255, 255, 255, 0.05);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            padding: 0 16px;
            font-size: 11px;
            color: rgba(255, 255, 255, 0.6);
        }
        
        .zoom-level {
            margin-left: auto;
        }
        
        /* Tema claro */
        @media (prefers-color-scheme: light) {
            body {
                background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 50%, #d0d0d0 100%);
                color: #333;
            }
            
            .nav-bar {
                background: rgba(255, 255, 255, 0.8);
                border-bottom-color: rgba(0, 0, 0, 0.1);
            }
            
            .nav-btn {
                background: rgba(0, 0, 0, 0.1);
                color: rgba(0, 0, 0, 0.8);
            }
            
            .nav-btn:hover {
                background: rgba(0, 0, 0, 0.2);
                color: black;
            }
            
            .address-container {
                background: rgba(255, 255, 255, 0.8);
                border-color: rgba(0, 0, 0, 0.2);
            }
            
            .address-bar {
                color: #333;
            }
            
            .address-bar::placeholder {
                color: rgba(0, 0, 0, 0.6);
            }
        }
    </style>
</head>
<body>
    <div class="browser-container">
        <!-- Barra de navega√ß√£o -->
        <div class="nav-bar">
            <!-- Controles de navega√ß√£o -->
            <div class="nav-controls">
                <button class="nav-btn" id="back-btn" title="Voltar" disabled>‚Üê</button>
                <button class="nav-btn" id="forward-btn" title="Avan√ßar" disabled>‚Üí</button>
                <button class="nav-btn" id="refresh-btn" title="Recarregar">‚ü≤</button>
            </div>
            
            <!-- Barra de endere√ßo -->
            <div class="address-container">
                <span class="ssl-indicator" id="ssl-indicator" style="display: none;">üîí</span>
                <input type="text" class="address-bar" id="address-bar" placeholder="Digite uma URL ou pesquise..." />
            </div>
            
            <!-- Controles da direita -->
            <div class="right-controls">
                <button class="nav-btn" id="bookmark-btn" title="Favoritos">‚≠ê</button>
                <button class="nav-btn" id="history-btn" title="Hist√≥rico">üïí</button>
                <button class="nav-btn" id="menu-btn" title="Menu">‚ãØ</button>
            </div>
        </div>
        
        <!-- Container do webview -->
        <div class="webview-container">
            <div class="loading-overlay" id="loading-overlay"></div>
            <webview id="webview" class="webview" src="https://www.google.com" allowpopups></webview>
        </div>
        
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3 id="sidebar-title">Favoritos</h3>
                <button class="nav-btn" id="close-sidebar">√ó</button>
            </div>
            <div class="sidebar-content" id="sidebar-content">
                <!-- Conte√∫do ser√° carregado dinamicamente -->
            </div>
        </div>
        
        <!-- Barra de status -->
        <div class="status-bar">
            <span id="status-text">Pronto</span>
            <span class="zoom-level" id="zoom-level">100%</span>
        </div>
    </div>

    <script>
        // Elementos DOM
        const webview = document.getElementById('webview');
        const addressBar = document.getElementById('address-bar');
        const backBtn = document.getElementById('back-btn');
        const forwardBtn = document.getElementById('forward-btn');
        const refreshBtn = document.getElementById('refresh-btn');
        const bookmarkBtn = document.getElementById('bookmark-btn');
        const historyBtn = document.getElementById('history-btn');
        const menuBtn = document.getElementById('menu-btn');
        const sidebar = document.getElementById('sidebar');
        const closeSidebarBtn = document.getElementById('close-sidebar');
        const sidebarTitle = document.getElementById('sidebar-title');
        const sidebarContent = document.getElementById('sidebar-content');
        const loadingOverlay = document.getElementById('loading-overlay');
        const statusText = document.getElementById('status-text');
        const sslIndicator = document.getElementById('ssl-indicator');
        const zoomLevel = document.getElementById('zoom-level');

        // Estado do navegador
        let currentUrl = 'https://www.google.com';
        let canGoBack = false;
        let canGoForward = false;
        let isLoading = false;
        let currentZoom = 100;

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('Glass Browser iniciado');
            
            // Carregar configura√ß√µes
            if (window.electronAPI) {
                try {
                    const settings = await window.electronAPI.getSettings();
                    if (settings.homepage && settings.homepage !== currentUrl) {
                        webview.src = settings.homepage;
                    }
                } catch (error) {
                    console.error('Erro ao carregar configura√ß√µes:', error);
                }
            }
            
            setupEventListeners();
        });

        // Event Listeners
        function setupEventListeners() {
            // Navega√ß√£o
            addressBar.addEventListener('keydown', handleAddressBarKeydown);
            backBtn.addEventListener('click', goBack);
            forwardBtn.addEventListener('click', goForward);
            refreshBtn.addEventListener('click', refresh);
            
            // Sidebar
            bookmarkBtn.addEventListener('click', () => toggleSidebar('bookmarks'));
            historyBtn.addEventListener('click', () => toggleSidebar('history'));
            closeSidebarBtn.addEventListener('click', closeSidebar);
            
            // Webview events
            webview.addEventListener('dom-ready', handleWebviewReady);
            webview.addEventListener('did-start-loading', handleLoadStart);
            webview.addEventListener('did-stop-loading', handleLoadStop);
            webview.addEventListener('did-navigate', handleNavigation);
            webview.addEventListener('did-navigate-in-page', handleNavigation);
            webview.addEventListener('page-title-updated', handleTitleUpdate);
            
            // Menu
            menuBtn.addEventListener('click', showMenu);
        }

        // Navega√ß√£o
        function handleAddressBarKeydown(e) {
            if (e.key === 'Enter') {
                navigate(e.target.value);
            }
        }

        function navigate(input) {
            let url = input.trim();
            
            if (!url) return;
            
            // Detectar se √© URL ou busca
            if (!url.includes('.') || (!url.startsWith('http://') && !url.startsWith('https://'))) {
                // Busca
                url = `https://www.google.com/search?q=${encodeURIComponent(url)}`;
            } else if (!url.startsWith('http://') && !url.startsWith('https://')) {
                // URL sem protocolo
                url = 'https://' + url;
            }
            
            webview.src = url;
            currentUrl = url;
        }

        function goBack() {
            if (canGoBack) {
                webview.goBack();
            }
        }

        function goForward() {
            if (canGoForward) {
                webview.goForward();
            }
        }

        function refresh() {
            webview.reload();
        }

        // Webview events
        function handleWebviewReady() {
            console.log('Webview pronto');
            updateNavigationButtons();
        }

        function handleLoadStart() {
            isLoading = true;
            loadingOverlay.classList.add('active');
            statusText.textContent = 'Carregando...';
            refreshBtn.innerHTML = '√ó';
            refreshBtn.title = 'Parar';
        }

        function handleLoadStop() {
            isLoading = false;
            loadingOverlay.classList.remove('active');
            statusText.textContent = 'Pronto';
            refreshBtn.innerHTML = '‚ü≤';
            refreshBtn.title = 'Recarregar';
            updateNavigationButtons();
            
            // Salvar no hist√≥rico
            if (window.electronAPI && currentUrl) {
                window.electronAPI.saveHistory({
                    url: currentUrl,
                    title: webview.getTitle() || currentUrl
                }).catch(console.error);
            }
        }

        function handleNavigation(event) {
            currentUrl = event.url;
            addressBar.value = currentUrl;
            
            // Atualizar indicador SSL
            if (currentUrl.startsWith('https://')) {
                sslIndicator.style.display = 'block';
            } else {
                sslIndicator.style.display = 'none';
            }
            
            updateNavigationButtons();
        }

        function handleTitleUpdate(event) {
            document.title = `${event.title} - Glass Browser`;
        }

        function updateNavigationButtons() {
            canGoBack = webview.canGoBack();
            canGoForward = webview.canGoForward();
            
            backBtn.disabled = !canGoBack;
            forwardBtn.disabled = !canGoForward;
        }

        // Sidebar
        function toggleSidebar(type) {
            if (sidebar.classList.contains('open')) {
                closeSidebar();
            } else {
                openSidebar(type);
            }
        }

        async function openSidebar(type) {
            sidebar.classList.add('open');
            
            if (type === 'bookmarks') {
                sidebarTitle.textContent = 'Favoritos';
                await loadBookmarks();
            } else if (type === 'history') {
                sidebarTitle.textContent = 'Hist√≥rico';
                await loadHistory();
            }
        }

        function closeSidebar() {
            sidebar.classList.remove('open');
        }

        async function loadBookmarks() {
            if (!window.electronAPI) return;
            
            try {
                const bookmarks = await window.electronAPI.getBookmarks();
                sidebarContent.innerHTML = '';
                
                bookmarks.forEach(bookmark => {
                    const item = createBookmarkItem(bookmark);
                    sidebarContent.appendChild(item);
                });
                
                if (bookmarks.length === 0) {
                    sidebarContent.innerHTML = '<p style="text-align: center; color: rgba(255,255,255,0.6); margin-top: 20px;">Nenhum favorito ainda</p>';
                }
            } catch (error) {
                console.error('Erro ao carregar favoritos:', error);
            }
        }

        async function loadHistory() {
            if (!window.electronAPI) return;
            
            try {
                const history = await window.electronAPI.getHistory();
                sidebarContent.innerHTML = '';
                
                history.slice(0, 50).forEach(item => {
                    const element = createHistoryItem(item);
                    sidebarContent.appendChild(element);
                });
                
                if (history.length === 0) {
                    sidebarContent.innerHTML = '<p style="text-align: center; color: rgba(255,255,255,0.6); margin-top: 20px;">Nenhum hist√≥rico ainda</p>';
                }
            } catch (error) {
                console.error('Erro ao carregar hist√≥rico:', error);
            }
        }

        function createBookmarkItem(bookmark) {
            const item = document.createElement('div');
            item.className = 'bookmark-item';
            item.innerHTML = `
                <div class="favicon"></div>
                <div class="site-info">
                    <div class="site-title">${bookmark.title}</div>
                    <div class="site-url">${bookmark.url}</div>
                </div>
            `;
            item.addEventListener('click', () => {
                navigate(bookmark.url);
                closeSidebar();
            });
            return item;
        }

        function createHistoryItem(item) {
            const element = document.createElement('div');
            element.className = 'history-item';
            element.innerHTML = `
                <div class="favicon"></div>
                <div class="site-info">
                    <div class="site-title">${item.title}</div>
                    <div class="site-url">${item.url}</div>
                </div>
            `;
            element.addEventListener('click', () => {
                navigate(item.url);
                closeSidebar();
            });
            return element;
        }

        function showMenu() {
            // Implementar menu contextual
            console.log('Menu clicked');
        }

        // Listeners para eventos do main process
        if (window.electronAPI) {
            window.electronAPI.on('navigate-to', (event, url) => {
                navigate(url);
            });
            
            window.electronAPI.on('go-back', goBack);
            window.electronAPI.on('go-forward', goForward);
            window.electronAPI.on('reload-page', refresh);
        }
    </script>
</body>
</html>
